//bruh - ruben was gay over here/
// who ever read it

module.exports = async (d) => {
  //stfu

  const code = d.command.code;

  const r = code.split("$findUser").length - 1;

  const inside = code.split("$findUser")[r].after();

  const err = d.inside(inside);

  if (err) return d.error(err);

  const fields = inside.splits;

  const returnAuthor = ["yes", "no"].includes(fields[fields.length - 1])
    ? fields.pop()
    : "yes";

  const option = fields.join(";");

  const client = d.client;

  let u =
    d.client.users.cache.get(option) ||
    d.message.mentions.users.first() ||
    d.client.users.cache.find(
      (m) =>
        m.tag.toLowerCase() === option.addBrackets().toLowerCase() ||
        m.username.addBrackets().toLowerCase() === option.toLowerCase()
    ) ||
    (returnAuthor === "yes" ? d.message.author : "");

  if (!u) {
    u = await d.client.users
      .fetch(option)
      .catch((err) => (returnAuthor === "yes" ? d.message.author : {}));
  }

  return {
    code: code.replaceLast(`$findUser${inside}`, u.id),
  };
};
